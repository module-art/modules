!function(e){var t={};function n(a){if(t[a])return t[a].exports;var o=t[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(a,o,function(t){return e[t]}.bind(null,o));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=2)}([,,function(e,t,n){e.exports=n(3)},function(e,t){$(document).ready(function(){$(".sidebarCollapse").on("click",function(){$("#sidebar").toggleClass("active")});var e=$("#id_page").html(),t="/images/visuel.jpg",n=0,a=4096e3,o=1200,r=$('meta[name="csrf-token"]').attr("content"),i="fr_FR",s=["advlist autolink lists link image charmap print preview anchor textcolor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste code help wordcount responsivefilemanager"],l="code | bold italic underline | bullist numlist | forecolor backcolor | link unlink | media responsivefilemanager",c="Header 2=h2;Header 3=h3;Header 4=h4;Header 5=h5;Paragraph=p",d="8pt 10pt 12pt 14pt 18pt 24pt 36pt",u="+*[*]",f="/tools/rfm/filemanager/",p="Gestionnaire de fichiers",m="date",b=!0,g="fsUn8A5u9e6UypkZ",v={filemanager:"/tools/rfm/filemanager/plugin.min.js"},h="i[class],a[class|name|href|target|title|onclick|rel],script[type|src],iframe[src|style|width|height|scrolling|marginwidth|marginheight|frameborder],img[class|src|border=0|alt|title|hspace|vspace|width|height|align|onmouseover|onmouseout|name],$elements";function _(e){e.on("focus",function(e){var i,s,l,c,d=$(e.target.bodyElement),u=$(".editrubrique").first(),f=u.css("background-image"),p='<section id="replacement" class="row justify-content-end mb-4"><div class="col-12 col-md-8 col-lg-6 col-xl-5"><div class="card"><div class="card-body"><form method="post" enctype="multipart/form-data" class="" id="replacement-form"><div class="form-group"><label for="image" class="col-form-label">Changer l\'image de fond</label><div class="input-group mb-2"><div class="input-group-prepend"><div class="input-group-text"><i class="far fa-file-image"></i></div></div><input id="image" class="form-control" type="file" name="image" /></div><div class="form-check mb-2"><input class="form-check-input" type="checkbox" value="1" name="delete_image"><label class="form-check-label" for="delete_image"> Image par défaut</label></div><input id="texte" type="hidden" name="texte" /><input type="hidden" name="_token" value="'+r+'" /><div class="row justify-content-between px-3"><button class="btn btn-primary btn-save" ><i class="fas fa-cog fa-spin fa-lg"></i> Enregistrer</button><button id="btn-cancel" class="btn btn-secondary" >Annuler</button></div></form></div></div></div></section>';$(".cols-button, .bloc-button").css("display","none"),void 0===$("#replacement")[0]&&d.parent().append(p),i=u,s=["jpg","jpeg","png"],l=document.querySelector("#image"),c=document.querySelector("#replacement-form"),l.addEventListener("change",function(){var e,t=this.files;if(e=(e=t[0].name.split("."))[e.length-1].toLowerCase(),-1!=s.indexOf(e)&&t[0].size<a){var r,l=new FileReader;l.readAsDataURL(t[0]),l.addEventListener("load",function(){(r=document.createElement("img")).src=this.result,setTimeout(function(){(n=r.naturalWidth)>=o?(!0,i.css("background-image",'url("'+r.src+'")')):(alert("Pour avoir un bon rendu sur tout type d'écran, la largeur de l'image doit être supérieure à "+o+"px. Cette image fait "+n+"px."),t=[],c.reset())},300)},!1)}else-1==s.indexOf(e)?alert("Image non valide, il faut un format jpg ou png."):t[0].size>=a&&alert("Image de taille supérieure à "+a/1e3+"ko. Il faut la réduire avec un logiciel adapté."),t=[],c.reset()},!1),$(".btn-save").on("mousedown",function(e){$(".fa-cog").css("display","inline-block"),e.preventDefault(),$("#texte").val(d.html());var n="/coulisses/rubrique/"+d.attr("data-rubrique_id"),a=new FormData($("#replacement-form")[0]);$.ajax({url:n,method:"post",data:a,dataType:"json",processData:!1,contentType:!1}).done(function(e){$(".fa-cog").css("display","none"),console.log(e.response),setTimeout(function(){d.css({padding:""}),$("#replacement").remove(),$(".cols-button, .bloc-button").css("display","block"),parseInt(e.img_deleted)&&u.css({backgroundImage:'url("'+t+'")'})},100)}).fail(function(e){$(".fa-cog").css("display","none");var t=e.responseJSON.message+"\n";$.each(e.responseJSON.errors,function(e,n){t+=n+"\n"}),alert("La requête n'a pas abouti.\n"+t)}),C()}),$("#btn-cancel").click(function(e){e.preventDefault(),setTimeout(function(){d.css({padding:""}),u.css({backgroundImage:f}),$("#replacement").remove(),$(".cols-button, .bloc-button").css("display","block")},100)})})}function y(e){e.on("focus",function(e){var t=$(e.target.bodyElement);t.parent().append('<div id="bloc-buttons"><button class="btn btn-primary btn-save pull-right" >Enregistrer</button></div>'),$(".btn-save").click(function(){var e=t.html(),n=t.attr("data-bloc_id"),a=0==n;if(type="",void 0!==e){a&&(type="col-12"==t.parent()[0].className?"large":"normal",n="rubrique-"+t.parents(".after-rubrique").first().attr("data-rubrique_id"));var o="/coulisses/bloc/"+n;$.ajax({url:o,method:"post",data:{_token:r,texte:e,format:type},dataType:"json"}).done(function(e){console.log(e.response),t.css("border","none"),a&&t.attr("data-bloc_id",e.newId)}).fail(function(){alert("La requête n'a pas abouti. Êtes-vous bien connecté comme admin?")}),C()}})}),e.on("blur",function(e){setTimeout(function(){$("#bloc-buttons").remove()},100)}),e.on("Change",function(e){$(e.target.bodyElement).css("border","1px red solid")})}function x(){$(".editrubrique").off(),tinymce.init({selector:".editrubrique",inline:!0,language:i,menubar:!1,branding:!1,plugins:s,toolbar:l,block_formats:c,fontsize_formats:d,paste_as_text:!0,image_advtab:!0,valid_elements:u,external_filemanager_path:f,filemanager_title:p,filemanager_sort_by:m,filemanager_descending:b,filemanager_access_key:g,relative_urls:!1,media_live_embeds:!0,external_plugins:v,extended_valid_elements:h,init_instance_callback:function(e){_(e)}})}function k(){$(".editable").off(),$(".edititre").off(),tinymce.init({selector:".editable",inline:!0,language:i,branding:!1,plugins:s,toolbar:l,block_formats:c,fontsize_formats:d,paste_as_text:!0,image_advtab:!0,valid_elements:u,external_filemanager_path:f,filemanager_title:p,filemanager_sort_by:m,filemanager_descending:b,filemanager_access_key:g,relative_urls:!1,media_live_embeds:!0,external_plugins:v,extended_valid_elements:h,init_instance_callback:function(e){y(e)}}),tinymce.init({selector:".edititre",inline:!0,language:i,menubar:!1,branding:!1,plugins:s,toolbar:l,block_formats:c,fontsize_formats:d,paste_as_text:!0,image_advtab:!0,valid_elements:u,external_filemanager_path:f,filemanager_title:p,filemanager_sort_by:m,filemanager_descending:b,filemanager_access_key:g,relative_urls:!1,media_live_embeds:!0,external_plugins:v,extended_valid_elements:h,init_instance_callback:function(e){y(e)}})}function q(){var e=$(".editdate"),t=$(".editheure");e.length>0&&(e.datetimepicker({locale:"fr",format:"L"}),e.on("change.datetimepicker",function(e){w(moment(e.date).format("YYYYMMDD"),$(this).attr("data-bloc_id"))})),t.length>0&&(t.datetimepicker({locale:"fr",format:"LT"}),t.on("change.datetimepicker",function(e){w(moment(e.date).format("HHmm"),$(this).attr("data-bloc_id"))})),$(".editnumber").click(function(){var e=$(this),t=e.attr("data-bloc_id"),n=e.html();e.addClass("d-none"),e.parent().prepend('<input id="nmber" type="text" value="'+n+'"/><div id="bloc-buttons"><button class="btn btn-primary btn-save pull-right" >Enregistrer</button></div>');var a=$("#nmber");a.focus(),a.blur(function(){e.html($(this).val()),setTimeout(function(){a.remove(),$("#bloc-buttons").remove(),e.removeClass("d-none")},100)}),$(".btn-save").click(function(){w(a.val(),t)})})}function w(e,t){var n="/coulisses/bloc/"+t;$.ajax({url:n,method:"post",data:{_token:r,texte:e,format:"date"},dataType:"json"}).done(function(e){console.log(e.response)}).fail(function(){alert("La requête n'a pas abouti. Êtes-vous bien connecté comme admin?")})}function j(){$(".add-bloc").off(),$(".change-type").off(),$(".add-bloc").click(function(){var e=$(this).parents(".row").first(),t=(e.children('[class*="col-md"]').first().attr("class"),e.parent().attr("data-rubrique_cols")),n=this.getAttribute("data-format"),a=$(this).attr("data-order"),o='<div class="col-12"><button class="btn btn-sm btn-outline-danger btn-destroy" ><i class="fas fa-trash-alt"></i></button><div class="editable" data-bloc_id="0"><h2>Nouveau bloc large</h2></div></div>',r='<div class="col-12 col-md-'+12/t+'"><button class="btn btn-sm btn-outline-danger btn-destroy" ><i class="fas fa-trash-alt"></i></button><div class="editable" data-bloc_id="0"><p>Nouveau paragraphe</p></div></div>';"asc"==a?"large"==n?e.append(o):"normal"==n&&e.append(r):"desc"==a&&("large"==n?e.prepend(o):"normal"==n&&e.prepend(r)),$(".after-rubrique").addClass("not-empty"),k(),T()}),$(".change-type").click(function(){var e=$(this).parents(".after-rubrique").first(),t=e.attr("data-rubrique_id");t=parseInt(t),$.ajax({method:"post",url:"/coulisses/change-type-content/"+t,data:{dbAction:$(this).attr("data-dbAction"),contentType:$(this).attr("data-contentType"),_token:r},dataType:"json"}).done(function(n){console.log(n.response),I(e,t)}).fail(function(e){console.log(e),alert("Oups! une erreur a empêché la modification")})})}function T(){$(".btn-destroy").off(),$(".btn-destroy").click(function(){if(confirm("Êtes vous sûr?")){var e=$(this).parent();if($(this).next().hasClass("editrubrique")){if(confirm("Tous les blocs associés à cette rubrique seront effacés. Êtes vous vraiment sûr?")){var t=$(this).next().attr("data-rubrique_id");$.ajax({method:"post",url:"/coulisses/destroyrubrique/"+t,data:{_token:r}}).done(function(t){e.next().remove(),e.remove(),console.log(t)}).fail(function(){alert("Oups! une erreur a empêché la suppression.")})}}else if(e.hasClass("type-content")){t=$(this).attr("data-rubrique_id");$.ajax({method:"post",url:"/coulisses/destroyrubrique/"+t,data:{_token:r}}).done(function(t){e.remove(),console.log(t)}).fail(function(){alert("Oups! une erreur a empêché la suppression.")})}else if(e.hasClass("type-index")){t=$(this).attr("data-rubrique_id");$.ajax({method:"post",url:"/coulisses/destroyrubrique/"+t,data:{_token:r}}).done(function(t){e.parents("tr").remove(),console.log(t)}).fail(function(){alert("Oups! une erreur a empêché la suppression.")})}else{var n=$(this).next().attr("data-bloc_id");0!=n?$.ajax({method:"post",url:"/coulisses/destroybloc/"+n,data:{_token:r}}).done(function(t){e.remove(),console.log(t)}).fail(function(){alert("Oups! une erreur a empêché la suppression.")}):e.remove()}$(".add-bloc").off(),j()}})}function E(){$(".change-col").off(),$(".ranger").off(),$(".inverser").off(),$(".change-col").click(function(){var e=$(this).parents(".row").first(),t=parseInt(this.getAttribute("data-colonnes")),n="",a=e.children(".col-12").not(".large-bloc"),o=e.parent().attr("data-rubrique_id");switch(o=parseInt(o),e.children(".clearfix").remove(),a.attr("class","col-12"),t){case 1:n="";break;case 2:n="col-md-6",a.addClass(n);break;case 3:n="col-md-6 col-lg-4",a.addClass(n)}$.ajax({method:"post",url:"/coulisses/cols/"+o,data:{cols:t,_token:r},dataType:"json"}).done(function(e){console.log(e.response),E(),setTimeout(function(){C()},900)}).fail(function(e){alert("Oups! une erreur a empêché la modification")})}),$(".ranger").click(function(){var e=$(this).parents(".after-rubrique").first(),t=e.attr("data-rubrique_id");I(e,t=parseInt(t))}),$(".inverser").click(function(){var e=$(this).parents(".after-rubrique").first(),t=e.attr("data-rubrique_id");$.ajax({method:"post",url:"/coulisses/ascdesc/"+t,data:{_token:r}}).done(function(n){console.log(n),parseInt(t),I(e,t)}).fail(function(){alert("Oups! une erreur a empêché l'inversion.")})}),$(".deplacer").click(function(){$(".editable").off(),$(".editrubrique").off(),$(".btn-destroy").off(),$(".add-bloc").off();var e=$(this).parents(".after-rubrique").first(),t=e.attr("data-rubrique_id");e.load("/coulisses/partial_drag/"+t,function(e,t,n){"error"==t?console.log(n.statusText):(E(),function(){function e(){var e=$(".dropzone"),t=e.length;t>0&&(e.css("width","2px"),setTimeout(function(){e.remove()},700))}for(var t,n,a,o,r=document.getElementById("drag-mode"),i=r.dataset.id,s=$(".dropy"),l=document.getElementsByClassName("dropy"),c=l.length,d=0;d<c;d++)l[d].addEventListener("dragstart",function(e){n=parseInt(this.dataset.position),e.dataTransfer.setData("text/plain","4Rt89dhMx"),t=e.target,e.target.style.opacity="0.5"},!1);function u(){s.off(),s.on("dragenter",function(s){var l,c,d;e(),s.stopPropagation(),o=parseInt(this.dataset.place),a=parseInt(this.dataset.position),dropzone=document.createElement("div"),dropzone.className=t.parentNode.className+" dropzone",dropzone.innerHTML='<div class="indropzone" style = "height: '+t.clientHeight+'px" ></div>',dropzone.style.width="2px",n>a?r.insertBefore(dropzone,this.parentElement):n<a&&(l=dropzone,c=this.parentElement,(d=c.parentNode).lastChild===c?d.appendChild(l):d.insertBefore(l,c.nextSibling)),$(this).off(),dropzone.addEventListener("transitionend",function(n){!function(n){n.addEventListener("dragover",function(e){e.preventDefault()},!1),n.addEventListener("drop",function(n){if(n.preventDefault(),"4Rt89dhMx"==n.dataTransfer.getData("text/plain")){var a=t.parentNode.cloneNode(!0),s=parseInt(t.dataset.place),l=$(this).parents(".after-rubrique").first();r.replaceChild(a,t.parentNode),setTimeout(function(){r.replaceChild(t.parentNode,n.target.parentNode),a.style.width="2px"},5),setTimeout(function(){r.removeChild(a),e(),t.style.opacity="1",u(),$.ajax({method:"post",url:"/coulisses/moveblock/"+i,data:{init_place:s,final_place:o,_token:$('[name="csrf-token"]').attr("content")},dataType:"json"}).done(function(e){console.log(e.response),I(l,i)}).fail(function(e){console.log(e),alert("Oups! une erreur a empêché la modification")})},705)}},!1)}(dropzone)},!1),setTimeout(function(){dropzone.style=null},5)})}u(),document.addEventListener("dragend",function(){e(),t.style.opacity="1",u()},!1),document.addEventListener("dragover",function(e){e.clientY<100?window.scrollBy(0,-10):e.clientY>window.innerHeight-100&&window.scrollBy(0,10)},!1)}())})})}function C(){var e=$(".editable iframe");0!=e.length&&(e.first().parent().css("width","100%"),e.each(function(){$(this).removeAttr("style");var e=$(this).width();$(this).width(Math.round(e)),$(this).height(Math.round(9*e/16))}))}function I(e,t){e.load("/coulisses/partial_bloc/"+t,function(e,n,a){"error"==n?console.log(a.statusText):(console.log("Blocs de la rubrique "+t+" actualisés."),k(),q(),E(),T(),j(),C())})}$("#add-rubrique").click(function(){var t=document.getElementById("global-wrapper");$.ajax({method:"post",url:"/coulisses/newrubrique/"+e,data:{_token:r}}).done(function(e){console.log(e.response);var n=document.createElement("div"),a=document.createElement("div");n.className="rubrique-container",a.className="container after-rubrique",t.appendChild(n),t.appendChild(a),$(n).load("/coulisses/partial/coulisses/rubrique/"+e.newId,function(){console.log(e.newId+" rubrique actualisée."),x()}),I($(a),e.newId),$("body,html").animate({scrollTop:window.innerHeight},1e3)}).fail(function(){alert("Oups! une erreur a empêché l'ajout de rubrique.")})}),$("#destroy-page").click(function(){confirm("Tous les contenus de cette page seront supprimés. Êtes vous vraiment sûr?")&&$.ajax({method:"delete",url:"/coulisses/destroypage/"+e,data:{_token:r}}).done(function(e){alert(e),location.assign("/coulisses/accueil")}).fail(function(){alert("Oups! une erreur a empêché la suppression.")})}),$("#publication").click(function(){var t=this;$.ajax({method:"post",url:"/coulisses/publicationpage/"+e,data:{_token:r}}).done(function(e){console.log(e);var n="Masquer"==t.innerText?"Publier":"Masquer";t.innerText=n}).fail(function(){alert("Oups! une erreur a empêché la publication.")})}),k(),x(),j(),T(),E(),window.onload=function(){C()}})}]);