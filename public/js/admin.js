!function(e){var t={};function a(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,a),o.l=!0,o.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(n,o,function(t){return e[t]}.bind(null,o));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/",a(a.s=2)}([,,function(e,t,a){e.exports=a(3)},function(e,t){$(document).ready(function(){$(".sidebarCollapse").on("click",function(){$("#sidebar").toggleClass("active")});var e=$("#id_page").html(),t=!1,a="/storage/"+current_theme+"/files/images/default_background.jpg",n=0,o=4096e3,r=1200,i=$('meta[name="csrf-token"]').attr("content");$("#add-rubrique").click(function(){document.getElementById("global-wrapper");$.ajax({method:"post",url:"/coulisses/newrubrique/"+e,data:{_token:i}}).done(function(e){console.log(e.response),document.location.reload(!0)}).fail(function(){alert("Oups! une erreur a empêché l'ajout de rubrique.")})}),$("#destroy-page").click(function(){confirm("Tous les contenus de cette page seront supprimés. Êtes vous vraiment sûr?")&&$.ajax({method:"delete",url:"/coulisses/destroypage/"+e,data:{_token:i}}).done(function(e){alert(e),location.assign("/coulisses")}).fail(function(){alert("Oups! une erreur a empêché la suppression.")})}),$("#publication").click(function(){var t=this;$.ajax({method:"post",url:"/coulisses/publicationpage/"+e,data:{_token:i}}).done(function(e){console.log(e);var a="Masquer"==t.innerText?"Publier":"Masquer";t.innerText=a}).fail(function(){alert("Oups! une erreur a empêché la publication.")})}),$(".btn-publish").click(function(){var e,t,a,n,o=$(this).next(".editrubrique").attr("data-rubrique_id");document.body.style.cursor="wait",e=$(this),t="publicationcontent",a=o,n=e.children().first(),$.ajax({method:"post",url:"/coulisses/"+t+"/"+a,data:{_token:i}}).done(function(t){document.body.style.cursor="default",console.log(t),n.is(".published")?(n.removeClass("published").addClass("unpublished").html('<i class="fas fa-eye"></i>'),e.attr("title","Publier cette rubrique")):(n.removeClass("unpublished").addClass("published").html('<i class="fas fa-eye-slash"></i>'),e.attr("title","Masquer cette rubrique"))}).fail(function(){document.body.style.cursor="default",alert("Oups! une erreur a empêché la modification.")})});var s="fr_FR",l=["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table paste code help wordcount responsivefilemanager"],c="code | bold italic underline | bullist numlist | forecolor backcolor | link unlink | media responsivefilemanager",d="Header 2=h2;Header 3=h3;Header 4=h4;Header 5=h5;Paragraph=p",u="8pt 10pt 12pt 14pt 18pt 24pt 36pt",f="+*[*]",p="/tools/rfm/filemanager/",m="Gestionnaire de fichiers",b="date",g=!0,h="fsUn8A5u9e6UypkZ",v={filemanager:"/tools/rfm/filemanager/plugin.min.js"},_="i[class],a[class|name|href|target|title|onclick|rel],script[type|src],iframe[src|style|width|height|scrolling|marginwidth|marginheight|frameborder],img[class|src|border=0|alt|title|hspace|vspace|width|height|align|style|onmouseover|onmouseout|name],$elements";function y(e){e.on("focus",function(e){var t=$(e.target.bodyElement);t.parent().append('<div id="bloc-buttons" class="d-flex justify-content-end"><button class="btn btn-primary btn-save">Enregistrer</button></div>'),$(".btn-save").on("mousedown",function(){var e=t.html(),a=t.attr("data-bloc_id"),n=0==a;if(type="",void 0!==e){n&&(type="col-12"==t.parent()[0].className?"large":"normal",a="rubrique-"+t.parents(".after-rubrique").first().attr("data-rubrique_id"));var o="/coulisses/bloc/"+a;$.ajax({url:o,method:"post",data:{_token:i,texte:e,format:type},dataType:"json"}).done(function(e){console.log(e.response),t.css("border","none"),n&&t.attr("data-bloc_id",e.newId)}).fail(function(){alert("La requête n'a pas abouti. Êtes-vous bien connecté comme admin?")}),C()}})}),e.on("blur",function(e){setTimeout(function(){$("#bloc-buttons").remove()},100)}),e.on("Change",function(e){$(e.target.bodyElement).css("border","1px red solid")})}function k(){$(".editable").off(),$(".edititre").off(),tinymce.init({selector:".editable",inline:!0,language:s,branding:!1,plugins:l,toolbar:c,block_formats:d,fontsize_formats:u,paste_as_text:!0,image_advtab:!0,valid_elements:f,external_filemanager_path:p,filemanager_title:m,filemanager_sort_by:b,filemanager_descending:g,filemanager_access_key:h,relative_urls:!1,media_live_embeds:!0,external_plugins:v,extended_valid_elements:_,init_instance_callback:function(e){y(e)}}),tinymce.init({selector:".edititre",inline:!0,language:s,menubar:!1,branding:!1,plugins:l,toolbar:c,block_formats:d,fontsize_formats:u,paste_as_text:!0,image_advtab:!0,valid_elements:f,external_filemanager_path:p,filemanager_title:m,filemanager_sort_by:b,filemanager_descending:g,filemanager_access_key:h,relative_urls:!1,media_live_embeds:!0,external_plugins:v,extended_valid_elements:_,init_instance_callback:function(e){y(e)}})}function x(){var e=$(".editdate"),t=$(".editheure");e.length>0&&(e.datetimepicker({locale:"fr",format:"L"}),e.on("change.datetimepicker",function(e){q(moment(e.date).format("YYYYMMDD"),$(this).attr("data-bloc_id"))})),t.length>0&&(t.datetimepicker({locale:"fr",format:"LT"}),t.on("change.datetimepicker",function(e){q(moment(e.date).format("HHmm"),$(this).attr("data-bloc_id"))})),$(".editnumber").click(function(){var e=$(this),t=e.attr("data-bloc_id"),a=e.html();e.addClass("d-none"),e.parent().prepend('<input id="nmber" type="text" value="'+a+'"/><div id="bloc-buttons"><button class="btn btn-primary btn-save pull-right" >Enregistrer</button></div>');var n=$("#nmber");n.focus(),n.blur(function(){e.html($(this).val()),setTimeout(function(){n.remove(),$("#bloc-buttons").remove(),e.removeClass("d-none")},100)}),$(".btn-save").click(function(){q(n.val(),t)})})}function q(e,t){var a="/coulisses/bloc/"+t;$.ajax({url:a,method:"post",data:{_token:i,texte:e,format:"date"},dataType:"json"}).done(function(e){console.log(e.response)}).fail(function(){alert("La requête n'a pas abouti. Êtes-vous bien connecté comme admin?")})}function j(){$(".add-bloc").off(),$(".change-type").off(),$(".add-bloc").click(function(){var e=$(this).parents(".markerRow").first(),t=(e.children('[class*="col-md"]').first().attr("class"),e.parent().attr("data-rubrique_cols")),a=this.getAttribute("data-format"),n=$(this).attr("data-order"),o='<div class="col-12"><button class="btn btn-sm btn-outline-danger btn-destroy" ><i class="fas fa-trash-alt"></i></button><div class="editable" data-bloc_id="0"><h2>Nouveau bloc large</h2></div></div>',r='<div class="col-12 col-md-'+12/t+'"><button class="btn btn-sm btn-outline-danger btn-destroy" ><i class="fas fa-trash-alt"></i></button><div class="editable" data-bloc_id="0"><p>Nouveau paragraphe</p></div></div>';"asc"==n?"large"==a?e.append(o):"normal"==a&&e.append(r):"desc"==n&&("large"==a?e.prepend(o):"normal"==a&&e.prepend(r)),$(".after-rubrique").addClass("not-empty"),k(),w()}),$(".change-type").click(function(){var e=$(this).parents(".after-rubrique").first().attr("data-rubrique_id");e=parseInt(e),$.ajax({method:"post",url:"/coulisses/change-type-content/"+e,data:{dbAction:$(this).attr("data-dbAction"),contentType:$(this).attr("data-contentType"),_token:i},dataType:"json"}).done(function(e){console.log(e.response),document.location.reload(!0)}).fail(function(e){console.log(e),alert("Oups! une erreur a empêché la modification")})})}function w(){$(".btn-destroy").off(),$(".btn-destroy").click(function(){if(confirm("Êtes vous sûr?")){var e=$(this).parent();if($(this).next().hasClass("editrubrique")){if(confirm("Tous les blocs associés à cette rubrique seront effacés. Êtes vous vraiment sûr?")){var t=$(this).next().attr("data-rubrique_id");$.ajax({method:"post",url:"/coulisses/destroyrubrique/"+t,data:{_token:i}}).done(function(t){e.next().remove(),e.remove(),console.log(t)}).fail(function(){alert("Oups! une erreur a empêché la suppression.")})}}else if(e.hasClass("type-content")){t=$(this).attr("data-rubrique_id");$.ajax({method:"post",url:"/coulisses/destroyrubrique/"+t,data:{_token:i}}).done(function(t){e.remove(),console.log(t)}).fail(function(){alert("Oups! une erreur a empêché la suppression.")})}else if(e.hasClass("type-index")){t=$(this).attr("data-rubrique_id");$.ajax({method:"post",url:"/coulisses/destroyrubrique/"+t,data:{_token:i}}).done(function(t){e.parents("tr").remove(),console.log(t)}).fail(function(){alert("Oups! une erreur a empêché la suppression.")})}else{var a=$(this).next().attr("data-bloc_id");0!=a?$.ajax({method:"post",url:"/coulisses/destroybloc/"+a,data:{_token:i}}).done(function(t){e.remove(),console.log(t)}).fail(function(){alert("Oups! une erreur a empêché la suppression.")}):e.remove()}$(".add-bloc").off(),j()}})}function T(){$(".change-col").off(),$(".ranger").off(),$(".inverser").off(),$(".change-col").click(function(){var e=$(this).parents(".markerRow").first(),t=parseInt(this.getAttribute("data-colonnes")),a="",n=e.find(".col-12").not(".large-bloc"),o=e.parent().attr("data-rubrique_id");switch(o=parseInt(o),e.children(".clearfix").remove(),n.attr("class","col-12"),t){case 1:a="";break;case 2:a="col-md-6",n.addClass(a);break;case 3:a="col-md-6 col-lg-4",n.addClass(a)}$.ajax({method:"post",url:"/coulisses/cols/"+o,data:{cols:t,_token:i},dataType:"json"}).done(function(e){console.log(e.response),T(),setTimeout(function(){C()},900)}).fail(function(e){alert("Oups! une erreur a empêché la modification")})}),$(".ranger").click(function(){var e=$(this).parents(".after-rubrique").first(),t=e.attr("data-rubrique_id");O(e,t=parseInt(t))}),$(".inverser").click(function(){var e=$(this).parents(".after-rubrique").first(),t=e.attr("data-rubrique_id");$.ajax({method:"post",url:"/coulisses/ascdesc/"+t,data:{_token:i}}).done(function(a){console.log(a),parseInt(t),O(e,t)}).fail(function(){alert("Oups! une erreur a empêché l'inversion.")})}),$(".deplacer").click(function(){$(".editable").off(),$(".editrubrique").off(),$(".btn-destroy").off(),$(".add-bloc").off();var e=$(this).parents(".after-rubrique").first(),t=e.attr("data-rubrique_id");e.load("/coulisses/partial_drag/"+t,function(e,t,a){"error"==t?console.log(a.statusText):(T(),function(){function e(){var e=$(".dropzone"),t=e.length;t>0&&(e.css("width","2px"),setTimeout(function(){e.remove()},700))}for(var t,a,n,o,r=document.getElementById("drag-mode"),i=r.dataset.id,s=$(".dropy"),l=document.getElementsByClassName("dropy"),c=l.length,d=0;d<c;d++)l[d].addEventListener("dragstart",function(e){a=parseInt(this.dataset.position),e.dataTransfer.setData("text/plain","4Rt89dhMx"),t=e.target,e.target.style.opacity="0.5"},!1);function u(){s.off(),s.on("dragenter",function(s){var l,c,d;e(),s.stopPropagation(),o=parseInt(this.dataset.place),n=parseInt(this.dataset.position),dropzone=document.createElement("div"),dropzone.className=t.parentNode.className+" dropzone",dropzone.innerHTML='<div class="indropzone" style = "height: '+t.clientHeight+'px" ></div>',dropzone.style.width="2px",a>n?r.insertBefore(dropzone,this.parentElement):a<n&&(l=dropzone,c=this.parentElement,(d=c.parentNode).lastChild===c?d.appendChild(l):d.insertBefore(l,c.nextSibling)),$(this).off(),dropzone.addEventListener("transitionend",function(a){!function(a){a.addEventListener("dragover",function(e){e.preventDefault()},!1),a.addEventListener("drop",function(a){if(a.preventDefault(),"4Rt89dhMx"==a.dataTransfer.getData("text/plain")){var n=t.parentNode.cloneNode(!0),s=parseInt(t.dataset.place),l=$(this).parents(".after-rubrique").first();r.replaceChild(n,t.parentNode),setTimeout(function(){r.replaceChild(t.parentNode,a.target.parentNode),n.style.width="2px"},5),setTimeout(function(){r.removeChild(n),e(),t.style.opacity="1",u(),$.ajax({method:"post",url:"/coulisses/moveblock/"+i,data:{init_place:s,final_place:o,_token:$('[name="csrf-token"]').attr("content")},dataType:"json"}).done(function(e){console.log(e.response),O(l,i)}).fail(function(e){console.log(e),alert("Oups! une erreur a empêché la modification")})},705)}},!1)}(dropzone)},!1),setTimeout(function(){dropzone.style=null},5)})}u(),document.addEventListener("dragend",function(){e(),t.style.opacity="1",u()},!1),document.addEventListener("dragover",function(e){e.clientY<100?window.scrollBy(0,-10):e.clientY>window.innerHeight-100&&window.scrollBy(0,10)},!1)}())})})}function C(){var e=$(".editable iframe");0!=e.length&&(e.first().parent().css("width","100%"),e.each(function(){$(this).removeAttr("style");var e=$(this).width();$(this).width(Math.round(e)),$(this).height(Math.round(9*e/16))}))}function O(e,t){e.load("/coulisses/partial_bloc/"+t,function(e,a,n){"error"==a?console.log(n.statusText):(console.log("Blocs de la rubrique "+t+" actualisés."),k(),x(),T(),w(),j(),C())})}k(),$(".editrubrique").off(),tinymce.init({selector:".editrubrique",inline:!0,language:s,branding:!1,plugins:l,toolbar:c,block_formats:d,fontsize_formats:u,paste_as_text:!0,image_advtab:!0,valid_elements:f,external_filemanager_path:p,filemanager_title:m,filemanager_sort_by:b,filemanager_descending:g,filemanager_access_key:h,relative_urls:!1,media_live_embeds:!0,external_plugins:v,extended_valid_elements:_,init_instance_callback:function(e){!function(e){e.on("focus",function(e){var s=$(e.target.bodyElement),l=s.hasClass("imagenode")?s:s.parents(".imagenode").first(),c=l.attr("data-image-src"),d='<section id="replacement" class="row justify-content-end mb-4"><div class="col-12 col-md-8 col-lg-6 col-xl-5"><div class="card"><div class="card-body"><form method="post" enctype="multipart/form-data" class="" id="replacement-form"><div class="form-group"><label for="image" class="col-form-label">Changer l\'image de fond</label><div class="input-group mb-2"><div class="input-group-prepend"><div class="input-group-text"><i class="far fa-file-image"></i></div></div><input id="image" class="form-control" type="file" name="image" /></div><div class="form-check mb-2"><input class="form-check-input" type="checkbox" value="1" name="delete_image"><label class="form-check-label" for="delete_image"> Image par défaut</label></div><input id="texte" type="hidden" name="texte" /><input type="hidden" name="_token" value="'+i+'" /><div class="row justify-content-between px-3"><button class="btn btn-primary btn-save" ><i class="fas fa-cog fa-spin fa-lg"></i> Enregistrer</button><button id="btn-cancel" class="btn btn-secondary" >Annuler</button></div></form></div></div></div></section>';$(".cols-button, .bloc-button").css("display","none"),void 0===$("#replacement")[0]&&s.parent().append(d),function(e,i){var s=["jpg","jpeg","png"],l=document.querySelector("#image"),c=document.querySelector("#replacement-form");l.addEventListener("change",function(){var a,i=this.files;if(a=(a=i[0].name.split("."))[a.length-1].toLowerCase(),-1!=s.indexOf(a)&&i[0].size<o){var l,d=new FileReader;d.readAsDataURL(i[0]),d.addEventListener("load",function(){(l=document.createElement("img")).src=this.result,setTimeout(function(){(n=l.naturalWidth)>=r?(t=!0,e.css("background-image",'url("'+l.src+'")')):(alert("Pour avoir un bon rendu sur tout type d'écran, la largeur de l'image doit être supérieure à "+r+"px. Cette image fait "+n+"px."),i=[],c.reset())},300)},!1)}else-1==s.indexOf(a)?alert("Image non valide, il faut un format jpg ou png."):i[0].size>=o&&alert("Image de taille supérieure à "+o/1e3+"ko. Il faut la réduire avec un logiciel adapté."),i=[],c.reset()},!1),$("input[name=delete_image]").change(function(){$(this).prop("checked")?(t=!0,e.css("background-image",'url("'+a+'")')):(t=!1,e.css("background-image",'url("'+i+'")'))})}(l,c),$(".btn-save").on("click",function(e){$(".fa-cog").css("display","inline-block"),e.preventDefault(),$("#texte").val(s.html());var t="/coulisses/rubrique/"+s.attr("data-rubrique_id"),n=new FormData($("#replacement-form")[0]);$.ajax({url:t,method:"post",data:n,dataType:"json",processData:!1,contentType:!1}).done(function(e){$(".fa-cog").css("display","none"),console.log(e.response),setTimeout(function(){s.css({padding:""}),$("#replacement").remove(),$(".cols-button, .bloc-button").css("display","block"),parseInt(e.img_deleted)&&l.css({backgroundImage:'url("'+a+'")'})},100)}).fail(function(e){$(".fa-cog").css("display","none");var t=e.responseJSON.message+"\n";$.each(e.responseJSON.errors,function(e,a){t+=a+"\n"}),alert("La requête n'a pas abouti.\n"+t)}),C()}),$("#btn-cancel").on("click",function(e){e.preventDefault(),setTimeout(function(){s.css({padding:""}),t&&l.css("background-image",'url("'+c+'")'),$("#replacement").remove(),$(".cols-button, .bloc-button").css("display","block")},100)})})}(e)}}),j(),w(),T(),C()})}]);