$(document).ready((function(){var e,i=$("#field-manage-script"),t=parseInt($("#fields-length").text());function n(){$(".remove-field-button").click((function(){o(),$(this).parent().remove(),c()}))}function a(){$(".up-button").click((function(){o();var e=$(this).parent();e.prev().before(e),c()}))}function l(){$(".down-button").click((function(){o();var e=$(this).parent();e.next().after(e),c()}))}function c(){var e=$("#field-manage-script").children("section");e.length-1?$(".remove-field-button").removeClass("d-none"):$(".remove-field-button").addClass("d-none"),e.first().children(".up-button").first().addClass("d-none"),e.last().children(".down-button").first().addClass("d-none")}function o(){$(".up-button").removeClass("d-none"),$(".down-button").removeClass("d-none")}n(),a(),l(),c(),function e(){$("#add-field-button").click((function(){o();var s='<section class="form-row justify-content-end"><div class="form-group col-11 col-md-5"><input type="text" name="champs-'+ ++t+'" class="form-control new" /><small class="invalid-feedback"></small></div><div class="form-group offset-1 col-11 offset-md-0 col-md-6"><div class="form-check"><input class="form-check-input" type="radio" name="type-'+t+'" value="text-raw" checked><label class="form-check-label">Texte brut</label></div><div class="form-check"><input class="form-check-input" type="radio" name="type-'+t+'" value="text" checked><label class="form-check-label">Texte</label></div><div class="form-check"><input class="form-check-input" type="radio" name="type-'+t+'" value="date"><label class="form-check-label">Date</label></div><div class="form-check"><input class="form-check-input" type="radio" name="type-'+t+'" value="time"><label class="form-check-label">Heure</label></div><div class="form-check"><input class="form-check-input" type="radio" name="type-'+t+'" value="nb"><label class="form-check-label">Nombre</label></div><div class="form-check"><input class="form-check-input" type="radio" name="type-'+t+'" value="checkbox"><label class="form-check-label">Case à cocher</label></div></div><div class="remove-field-button" id=""><i class="fas fa-minus-circle"></i></div><div class="up-button" id=""><i class="fas fa-arrow-circle-up"></i></div><div class="down-button" id=""><i class="fas fa-arrow-circle-down"></i></div></section>';i.append(s),$("input[name=champs-"+t+"]").focus().blur((function(){var e=[];i.children("section").find(".form-control").each((function(){e.push($(this).val())})),function(e){var i={};for(var t in e.forEach((function(e){i[e]=i[e]?i[e]+=1:1})),i)if(i[t]>=2)return!0;return!1}(e)&&($("input[name=champs-"+t+"]").addClass("is-invalid").next().html("Ce champ existe déjà."),$("button[type=submit]").prop("disabled",!0),$("#add-field-button").off())})),$("input[name=champs-"+t+"]").focus((function(){$(this).removeClass("is-invalid"),$("button[type=submit]").prop("disabled",!1),e()})),n(),a(),l(),c()}))}(),$("#the-form").submit((function(e){var t,n={fields:[]};i.children("section").each((function(){var e=$(this).find("input[type=radio]:checked").val(),i=$(this).find(".form-control").first();n.fields.push({name:i.val(),type:e,isNew:!!i.hasClass("new")})})),t=n,$("input[name=champs]").val(JSON.stringify(t))})),$(".field-editor").click((function(){e=$(this).prev(),$("#modalFieldEditor").modal("show"),$("input[name=new-field]").val(e.val()),$("input[name=old-field]").val(e.val()),$("input[name=new-type][value="+$(this).parents("section.form-row").find("input[type=radio]:checked").val()+"]").prop("checked",!0),$("input[name=old-type]").val($(this).parents("section.form-row").find("input[type=radio]:checked").val())})),$("#field-update").click((function(){var i=$("input[name=new-field]").val(),t=$("input[name=old-field]").val(),n=$("input[name=new-type]:checked").val(),a=$("input[name=old-type]").val(),l=$(this);i!=t||n!=a?(l.css("cursor","wait"),$.ajax({method:"put",url:"/coulisses/type-field/"+$("input[name=type_id]").val(),data:{_token:$('[name="csrf-token"]').attr("content"),newField:i,oldField:t,newType:n,oldType:a},dataType:"json"}).done((function(t){l.css("cursor","default"),"error"in t?$("input[name=new-field]").addClass("is-invalid").next().html(t.error):($("input[name=new-field]").removeClass("is-invalid"),e.val(i),e.parents("section").first().find("input[type=radio][value="+n+"]").prop("checked",!0),$("#modalFieldEditor").modal("hide"))})).fail((function(e){l.css("cursor","default")}))):$("#modalFieldEditor").modal("hide")}))}));